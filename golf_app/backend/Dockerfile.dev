# Development Dockerfile for Spring Boot backend with live reloading
FROM eclipse-temurin:21-jdk-alpine

WORKDIR /app

# Install Maven (since we'll be running mvn commands)
RUN apk add --no-cache curl && \
    curl -fsSL https://archive.apache.org/dist/maven/maven-3/3.9.5/binaries/apache-maven-3.9.5-bin.tar.gz | tar xzf - -C /opt && \
    ln -s /opt/apache-maven-3.9.5 /opt/maven && \
    ln -s /opt/maven/bin/mvn /usr/local/bin/mvn

# Copy source code (will be overridden by volume mount)
COPY . .

# Make mvnw executable
RUN chmod +x ./mvnw

# Install dependencies
RUN ./mvnw dependency:go-offline -B

# Expose Spring Boot port and LiveReload port
EXPOSE 8080 35729

# Start development server with Spring Boot DevTools
CMD ["./mvnw", "spring-boot:run", "-Dspring-boot.run.jvmArguments='-Dspring.profiles.active=dev'"]